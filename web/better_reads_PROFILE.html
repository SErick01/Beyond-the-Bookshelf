<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Better Reads-Profile</title>
     <script src = "https://cdn.tailwindcss.com"></script>
     <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <style>
        section, .calendar-box, .cat-of-the-day-card {
            padding: 1.25rem; /* p-5 */
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        .nav-link {
        color: #000;
        text-decoration: none;
        font-weight: bold;
        transition: color 0.2s ease;
    }
    
    .nav-link:hover {
        color: #51200F;
    }
    .calendar-box {
            background-color: var(--tw-colors-sidebar-bg);
            color: var(--tw-colors-dark-brown);
        }

        .calendar .Weeks {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            list-style: none;
            padding: 0;
            text-align: center;
            font-weight: bold;
            margin-bottom: 0.5rem;
            border-bottom: 1px solid rgba(81, 32, 15, 0.2);
            padding-bottom: 5px;
        }

        .calendar .Days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            list-style: none;
            padding: 0;
            text-align: center;
        }

        .calendar .Days li {
            padding: 0.5rem 0;
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 0.9rem;
            border-radius: 9999px; /* full rounded */
        }

        .calendar .Days li.inactive {
            color: rgba(81, 32, 15, 0.5); /* lighter dark-brown */
            cursor: default;
        }

        .calendar .Days li.active {
            background-color: var(--tw-colors-primary-orange);
            color: #EB7F50;
            font-weight: bold;
        }

        .calendar .icons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .calendar .icons span {
            cursor: pointer;
            color: var(--tw-colors-dark-brown);
            padding: 0.25rem;
            border-radius: 9999px;
            transition: background-color 0.2s;
        }

        .calendar .icons span:hover {
            background-color: rgba(81, 32, 15, 0.1);
        }
    </style>
</head>
<body class = "bg-[#F2DBC8] font-sans text-dark-text min-h-screen flex flex-col">
    
<!-- Nav BARRRRRRRRRRRR-->
<header class="bg-[#EB7F50] shadow-lg sticky top-0 z-20">
        <div class="flex  justify-between items-center p-4">
            <div class="flex items-center space-x-3">
                <div class="w-16 h-16">
                    <div class="w-16 h-16">
                    <img 
                        src="Cat_Logo.png" 
                        alt="Cat Logo" 
                        class="w-full h-full object-contain" 
                    >
                    </div>
                </div>
                <h1 class="text-2xl font-extrabold text-black">
                    <a href="better_reads_hp.html" class="nav-link">BETTER READS</a>
                </h1>
            </div>
            
            <div class="flex items-center">
                <nav class="hidden md:flex space-x-6">
                    <a id="nav-login" href="index.html" class="nav-link">LOGIN</a>
                    <a id="nav-logout" href="#" class="nav-link" style="display:none">LOGOUT</a>
                    <a href="better_reads_PROFILE.html" class="nav-link">PROFILE</a>
                    <a href="better_reads_mb.html" class="nav-link">MY BOOKS</a>
                    <a href="better_reads_browse.html" class="nav-link">BROWSE</a>
                    <div class = "relative " id = "dropdown-parent">
                        <button 
                            class="Drop-Down-Menu-Icon-BTN"
                            aria-expanded="false"
                            aria-haspopup="true"
                            onclick="toggleDropdown(event)"
                            >
                            &#9776;
                        </button>
                        <div
                         id = "dropdown-menu"
                         class = "absolute right-0 mt-3 w-40 bg-white border border-gray-200 rounded-lg shadow-xl hidden origin-top-right transform transition duration-200 ease-out z-30 overflow-hidden">
                        <a href="add-friends.html" class="block px-4 py-2 text-gray-700 hover:bg-orange-100 hover:text-primary-orange transition duration-150 whitespace-nowrap">
                            Add Friends
                        </a>
                        <a href="#" class="block px-4 py-2 text-red-600 hover:bg-red-50 transition duration-150 whitespace-nowrap">
                            Logout
                        </a>
                        </div>
                </nav>
            </div>
        </div>
    </header>
 
<!-- Banner and Website Logo -->
<main class="relative mb-8 shadow-xl">
    <img 
        src="ross-tejada-studying-cat-banner.jpg" 
        alt="Pixel Art Cat Reading" 
        class="w-full max-h-80 h-full object-cover"
    >    
</main>

<!-- Current Reads-->
<div class = "container mx-auto px-4 grid grid-cols-1 lg:grid-cols-12 gap-6 mt-6 pb-12">
    <section class = "lg:col-span-3 space-y-6 bg-[#BAAF6F] rounded-lg">
        <h2 class = "text-2xl font-bold text-dark-text mb-4">Current Reads</h2>
        <div class ="Current-Read-item-1 flex space-x-4 items-start bg-sidebar-bg/70 p-3 rounded-lgt">
            <img
                src = "76713323._SY180_.jpg"
                alt = "Cover of Empire of Storms by Sarah J. Maas"
                class = "w-16 h-24 object-cover shadow-md rounded"
            >
            <div class = "flex-grow">
                <p class = "font-bold text-base leading-tight">Empire of Storms</p>
                <p class = "text-sm text-dark-text/80">Sarah J. Maas </p>

                <div class = "w-full h-2 bg-dark-text/30 rounded-full mt-2 overflow-hidden">
                    <div class="bg-[#EB7F50] h-2 rounded-full" id="progress-bar" 
                    style="width: 20.6%"></div>
                </div>
                <button class=" mt-3 bg-[EB7F50] text-white text-sm px-4 py-1 rounded-full shadow hover:bg-dark-text transition duration-200"> Update Progress</div>
                </button>
        </div>
        <div class ="Current-Read-item-2 flex space-x-4 items-start bg-sidebar-bg/70 p-3 rounded-lg">
            <img
                src = "222946916._SY180_.jpg"
                alt = "Cover of For Whom the Belle Tolls by Jaysea Lynn"
                class = "w-16 h-24 object-cover shadow-md rounded"
            >
            <div class = "flex-grow">
                <p class = "font-bold text-lg leading-tight">For Whom the Belle Tolls</p>
                <p class = "text-sm text-dark-text/80">Jaysea Lynn </p>

                <div class = "w-full h-2 bg-dark-text/30 rounded-full mt-2 overflow-hidden">
                    <div class="bg-[#EB7F50] h-2 rounded-full" id="progress-bar" 
                    style="width: 57.6%"></div>   
                </div>
                <button class="mt-3 bg-[EB7F50] text-white text-sm px-4 py-1 rounded-full shadow hover:bg-dark-text transition duration-200"> Update Progress
                </button>
            </div>
        </div>
    </section>

 <!-- Favorites -->
   <div class ="lg:col-span-6 space-y-6" >
        <section class="bg-[#E5C09E]">
            <h2 id="favorites-heading" class="text-2xl font-bold mb-6">My Favorites</h2>
            <div id="row-favorites"
                class="Recommended-books grid grid-cols-3 sm:grid-cols-5 md:grid-cols-6 lg:grid-cols-7 gap-3 bg-E5C09E">
            </div>
        </section>

<body>
  
    <aside class="lg:col-span-3 space-y-6">
        <div class="calendar-box bg-sidebar-bg">
            <div class="icons flex justify-between items-center mb-2">
                <span class="material-symbols-rounded cursor-pointer" onclick="navigateCalendar(-1)">chevron_left</span>
                <p id="current-date" class="font-bold text-xl">November 2025</p>
                <span class="material-symbols-rounded cursor-pointer" onclick="navigateCalendar(1)">chevron_right</span>
             </div>
            <div class = "calendar">
                <ul class ="Weeks"> 
                    <li>Sun</li>
                    <li>Mon</li>
                    <li>Tue</li>
                    <li>Wed</li>
                    <li>Thu</li>
                    <li>Fri</li>
                    <li>Sat</li>
                </ul>
                <ul class ="Days"> </ul>
            </div> 
  
<footer class="bg-[#51200F] text-white py-4 mt-auto">
    <div class="container mx-auto flex flex-col sm:flex-row justify-between items-center px-4">
        <div class="footer-links space-x-4 mb-2 sm:mb-0">
            <a href="#" class="hover:text-primary transition">About the Company</a>
            <a href="#" class="hover:text-primary transition">Contact Us</a>
        </div>
        <p class="copyright">&copy; Copyright 2025 | Better Reads</p>
    </div>
</footer>
<script>
    let date = new Date();
    let currYear = date.getFullYear();
    let currMonth = date.getMonth(); 
    const monthNames = ["January", "February", "March", "April", "May", "June", "July",
                    "August", "September", "October", "November", "December"];

    // --- DOM Elements (Accessed via DOMContentLoaded) ---
    const currentDateEl = document.getElementById("current-date");
    const daysContainer = document.querySelector(".Days");

    function renderCalendar() {
    let lastDayOfMonth = new Date(currYear, currMonth + 1, 0).getDate();
    let firstDayOfMonthIndex = new Date(currYear, currMonth, 1).getDay();
    let lastDayOfLastMonth = new Date(currYear, currMonth, 0).getDate();
    let liTag = "";

    for (let i = firstDayOfMonthIndex; i > 0; i--) {
        liTag += `<li class="inactive">${lastDayOfLastMonth - i + 1}</li>`;
    }

    for (let i = 1; i <= lastDayOfMonth; i++) { 
        let isToday = i === new Date().getDate() && currMonth === new Date().getMonth() 
            && currYear === new Date().getFullYear() ? "active" : "";
        liTag += `<li class="${isToday}">${i}</li>`;
    }

    const totalCells = firstDayOfMonthIndex + lastDayOfMonth;
    const remainingCells = 42 - totalCells; 
    const nextMonthStart = totalCells <= 35 ? (35 - totalCells) : (42 - totalCells);
    for (let i = 1; i <= nextMonthStart; i++) {
        liTag += `<li class="inactive">${i}</li>`;
    }

    currentDateEl.textContent = `${monthNames[currMonth]} ${currYear}`;
    daysContainer.innerHTML = liTag;
    }

    function navigateCalendar(nav) {
    currMonth += nav;
    if (currMonth < 0 || currMonth > 11) {
        date = new Date(currYear, currMonth);
        currYear = date.getFullYear();
        currMonth = date.getMonth();
    } 
    renderCalendar();
    }

    window.navigateCalendar = navigateCalendar;
    renderCalendar();    
</script>
<script>
    (async () => {
        const token = localStorage.getItem('btb_token');
        if (!token) {
            window.location.href = 'index.html';
            return;
        }

        try {
            const apiBase = 'https://beyond-the-bookshelf.onrender.com';
            const res = await fetch(`${apiBase}/api/users/me`, {
                headers: { Authorization: `Bearer ${token}` },
                mode: 'cors'
            });
            if (!res.ok) throw new Error('Auth check failed');
        } catch (err) {
            localStorage.removeItem('btb_token');
            window.location.href = 'index.html';
        }
    })();
</script>
<script>
  (function () {
    const loginLink  = document.getElementById('nav-login');
    const logoutLink = document.getElementById('nav-logout');

    if (!loginLink || !logoutLink) return;
    loginLink.style.display = 'none';
    logoutLink.style.display = '';

    logoutLink.addEventListener('click', (e) => {
      e.preventDefault();
      try {
        if (window.supabase?.auth?.signOut) {
          window.supabase.auth.signOut().catch(()=>{});
        }
      } catch (_) {}
      localStorage.removeItem('btb_token');
      window.location.href = 'index.html';
    });
  })();
</script>
<script>
  (async () => {
    const favoritesHeading  = document.getElementById("favorites-heading");
    const favoritesContainer = document.getElementById("row-favorites");
    if (!favoritesContainer) return;

    const STORAGE_BASE = "https://swfkspdirzdqotywgvop.supabase.co/storage/v1/object/public/";
    const PLACEHOLDER  = STORAGE_BASE + "cover/placeholder.jpg";

    favoritesContainer.innerHTML =
      `<p class="col-span-3 text-center text-sm text-[#51200F]">
         Loading favoritesâ€¦
       </p>`;

    const token = localStorage.getItem("btb_token");
    if (!token) {
      favoritesContainer.innerHTML =
        `<p class="col-span-3 text-center text-sm text-[#51200F]">
           Please log in to see your favorites.
         </p>`;
      return;
    }

    const apiBase = "https://beyond-the-bookshelf.onrender.com";

    function renderFavorites(rows) {
      if (!rows || !rows.length) {
        favoritesContainer.innerHTML =
          `<p class="col-span-3 text-center text-sm text-[#51200F]">
             You don't have any favorites yet.
           </p>`;
        return;
      }

      const frag = document.createDocumentFragment();

      for (const row of rows) {
        const title = row.title || "Unknown title";
        let imgSrc = PLACEHOLDER;

        if (row.cover_url) {
          imgSrc = row.cover_url.startsWith("http")
            ? row.cover_url
            : STORAGE_BASE + row.cover_url.replace(/^\/+/, "");
        }

        const link = document.createElement("a");
        link.href =
          `View-book.html?work_id=${encodeURIComponent(row.work_id)}` +
          `&edition_id=${encodeURIComponent(row.edition_id ?? "")}`;
        link.className = "block";

        const img = document.createElement("img");
        img.src = imgSrc;
        img.alt = title;
        img.className =
          "w-full h-auto object-cover shadow-xl rounded " +
          "hover:scale-[1.03] transition-transform duration-300 cursor-pointer";

        img.onerror = () => {
          img.onerror = null;
          img.src = PLACEHOLDER;
          if (!link.querySelector("p")) {
            const p = document.createElement("p");
            p.textContent = title;
            p.className =
              "mt-1 text-xs font-semibold text-center text-[#51200F]";
            link.appendChild(p);
          }
        };

        if (!row.cover_url) {
          const p = document.createElement("p");
          p.textContent = title;
          p.className =
            "mt-1 text-xs font-semibold text-center text-[#51200F]";
          link.appendChild(p);
        }

        link.appendChild(img);

        const wrapper = document.createElement("div");
        wrapper.className = "book-card";
        wrapper.appendChild(link);
        frag.appendChild(wrapper);
      }

      favoritesContainer.innerHTML = "";
      favoritesContainer.appendChild(frag);
    }

    try {
      const res = await fetch(`${apiBase}/api/home/favorites?limit=21`, {
        headers: { Authorization: `Bearer ${token}` },
        mode: "cors",
      });

      if (!res.ok) {
        console.warn("[Favorites] API error", res.status);
        favoritesContainer.innerHTML =
          `<p class="col-span-3 text-center text-sm text-red-700">
             Error loading favorites (${res.status}).
           </p>`;
        return;
      }

      const data = await res.json();
      renderFavorites(data);
    } catch (err) {
      console.error("[Favorites] Fetch failed", err);
      favoritesContainer.innerHTML =
        `<p class="col-span-3 text-center text-sm text-red-700">
           Error loading favorites.
         </p>`;
    }
  })();
</script>
</body>
</html>